# Гибридная система управления температурой

Проект представляет собой реализацию системы управления температурой, использующей различные подходы: классический ПИД-регулятор, нейронные сети (LSTM, GRU, TCN, Transformer) и MPC (Model Predictive Control). Система разработана для эффективного управления охлаждением помещения с учетом различных температурных режимов и внешних воздействий.

## Структура проекта

```
pid-ai/
├── simulation.py           # Основной файл симуляции с различными режимами управления
├── train_nn.py            # Обучение нейронной сети LSTM
├── train_tcn.py           # Обучение нейронной сети TCN
├── train_gru.py           # Обучение нейронной сети GRU
├── train_transformer.py   # Обучение нейронной сети Transformer
├── model.pth              # Обученная модель LSTM
├── tcn_model.pth          # Обученная модель TCN
├── gru_model.pth          # Обученная модель GRU
├── transformer_model.pth  # Обученная модель Transformer
├── scaler_params.json     # Параметры нормализации данных для LSTM
├── tcn_scaler_params.json # Параметры нормализации данных для TCN
├── gru_scaler_params.json # Параметры нормализации данных для GRU
└── transformer_scaler_params.json # Параметры нормализации данных для Transformer
```

## Компоненты системы

### 1. Симуляция и контроллеры (`simulation.py`)
- Реализация классического ПИД-регулятора
- Модель помещения с учетом тепловой инерции
- Генератор случайных тепловых воздействий на основе шума Перлина
- Поддержка случайных начальных (25-35°C) и целевых (18-28°C) температур
- Поддержка мощных тепловых возмущений ("strong disturbances")
- Реализация MPC (Model Predictive Control) с оптимизацией на горизонте предсказания
- Параметры регулятора:
  - Kp = 5.0 (пропорциональный коэффициент)
  - Ki = 0.5 (интегральный коэффициент)
  - Kd = 0.2 (дифференциальный коэффициент)

### 2. Нейронные сети

#### LSTM (`train_nn.py`)
- Архитектура: LSTM (Long Short-Term Memory)
- Структура сети:
  - Входной слой: 5 признаков
  - LSTM слои: 2 слоя, 32 нейрона
  - Полносвязные слои: 32 → 16 → 1
  - Dropout для предотвращения переобучения
  - Sigmoid на выходе

#### TCN (`train_tcn.py`)
- Архитектура: Temporal Convolutional Network
- Структура сети:
  - Входной слой: 5 признаков
  - Сверточные блоки с расширенной сверткой
  - Каналы: [32, 32]
  - Полносвязные слои: 32 → 16 → 1
  - Dropout и ReLU активации

#### GRU (`train_gru.py`)
- Архитектура: Gated Recurrent Unit
- Структура сети:
  - Входной слой: 5 признаков
  - GRU слои: 2 слоя, 32 нейрона
  - Полносвязные слои: 32 → 16 → 1
  - Dropout для регуляризации

#### Transformer (`train_transformer.py`)
- Архитектура: Transformer для временных рядов
- Структура сети:
  - Входной слой: 5 признаков
  - Multi-head attention (4 головы)
  - 2 слоя трансформера
  - Размерность модели: 32
  - Полносвязные слои для прогнозирования

### 3. MPC контроллер
- Оптимизация на горизонте предсказания
- Учет энергопотребления в целевой функции
- Адаптивное управление с учетом возмущений
- Параметры:
  - Горизонт предсказания: 20 шагов
  - Вес штрафа за энергию: 0.1

## Установка и запуск

1. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
pip install -r requirements.txt
```

2. Запустите симуляцию для сбора данных:
```bash
python simulation.py --mode pid --num_simulations 10
```

3. Обучите выбранную модель:
```bash
# Для LSTM
python train_nn.py
# Для TCN
python train_tcn.py
# Для GRU
python train_gru.py
# Для Transformer
python train_transformer.py
```

4. Запустите симуляцию с выбранным контроллером:
```bash
# ПИД-регулятор
python simulation.py --mode pid --num_simulations 5

# Гибридный LSTM
python simulation.py --mode hybrid --num_simulations 5

# TCN
python simulation.py --mode tcn --num_simulations 5

# GRU
python simulation.py --mode gru --num_simulations 5

# Transformer
python simulation.py --mode transformer --num_simulations 5

# MPC
python simulation.py --mode mpc --num_simulations 5
```

## Особенности и улучшения

1. Разнообразие моделей:
   - Классический ПИД-регулятор
   - Нейронные сети (LSTM, GRU, TCN, Transformer)
   - MPC с оптимизацией

2. Улучшенный процесс обучения:
   - Валидация и ранняя остановка
   - Проверка сходимости
   - Адаптивная скорость обучения
   - Сохранение лучшей модели

3. Реалистичное моделирование:
   - Тепловая инерция помещения
   - Случайные тепловые возмущения
   - Шум Перлина для генерации помех
   - Модуляция и случайные всплески

4. Визуализация результатов:
   - Графики обучения
   - Графики температуры и управляющего сигнала
   - Сохранение результатов с временными метками

## Результаты

Система демонстрирует:
- Эффективное достижение различных целевых температур
- Стабильную работу при разных начальных условиях
- Устойчивость к тепловым возмущениям
- Плавное управление без перерегулирования
- Сравнительный анализ различных подходов к управлению

## Дальнейшие улучшения

1. Реализация онлайн-обучения в процессе работы
2. Адаптивная настройка параметров моделей
3. Оптимизация архитектур нейронных сетей
4. Улучшение MPC с учетом нелинейностей
5. Интеграция с реальными системами управления

## Примечания

- Система адаптирована для работы с различными температурными режимами
- Все параметры могут быть настроены через аргументы командной строки
- Для гибридных моделей можно настраивать коэффициент смешивания α
- Результаты каждой симуляции сохраняются с уникальной временной меткой