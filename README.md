# Гибридная система управления температурой

Проект представляет собой реализацию гибридной системы управления температурой, объединяющей классический ПИД-регулятор и нейронную сеть LSTM. Система разработана для эффективного управления охлаждением помещения с учетом различных температурных режимов и внешних воздействий.

## Структура проекта

```
pid-ai/
├── simulation.py     # Основной файл симуляции с ПИД и гибридным режимами
├── train_nn.py      # Обучение нейронной сети LSTM
├── model.pth        # Обученная модель LSTM
└── scaler_params.json  # Параметры нормализации данных
```

## Компоненты системы

### 1. Симуляция и ПИД-регулятор (`simulation.py`)
- Реализация классического ПИД-регулятора
- Модель помещения с учетом тепловой инерции
- Генератор случайных тепловых воздействий на основе шума Перлина
- Поддержка случайных начальных (25-35°C) и целевых (18-28°C) температур
- Поддержка мощных тепловых возмущений ("strong disturbances"), возникающих несколько раз за симуляцию. Параметры (количество, длительность, амплитуда) настраиваются через командную строку.
- Параметры регулятора:
  - Kp = 2.0 (пропорциональный коэффициент)
  - Ki = 0.1 (интегральный коэффициент)
  - Kd = 0.05 (дифференциальный коэффициент)

### 2. Нейронная сеть (`train_nn.py`)
- Архитектура: LSTM (Long Short-Term Memory)
- Структура сети:
  - Входной слой: 5 признаков (текущая температура, целевая температура, ошибка, интеграл, производная)
  - LSTM слои: 2 слоя, 64 нейрона
  - Полносвязные слои с уменьшением размерности: 64 → 32 → 1
  - Dropout для предотвращения переобучения
  - Функция активации выходного слоя: Sigmoid
- Параметры обучения:
  - Размер последовательности: 10
  - Размер батча: 32
  - Количество эпох: до 100 с ранней остановкой
  - Скорость обучения: 0.001
  - Валидация на отдельном наборе данных

### 3. Гибридный регулятор
- Объединяет ПИД-регулятор и LSTM
- Параметр смешивания α (alpha):
  - α = 0: только ПИД-регулятор
  - α = 1: только нейронная сеть
  - α = 0.5 (по умолчанию): равное влияние обоих компонентов
- Нормализация входных данных с помощью MinMaxScaler

## Установка и запуск

1. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
pip install -r requirements.txt
```

2. Запустите симуляцию с ПИД-регулятором для сбора данных:
```bash
python simulation.py --mode pid --num_simulations 10
```
# Для проверки устойчивости к мощным возмущениям используйте:
python simulation.py --mode pid --num_simulations 10 --strong_disturbances
# Можно дополнительно указать параметры:
# --num_strong_events 5 --strong_event_duration 15 --strong_event_amplitude 12

3. Обучите нейронную сеть на собранных данных:
```bash
python train_nn.py
```

4. Запустите симуляцию с гибридным регулятором:
```bash
python simulation.py --mode hybrid --num_simulations 5
```

## Особенности и улучшения

1. Разнообразие данных для обучения:
   - Случайные начальные температуры
   - Случайные целевые температуры
   - Множество сценариев работы системы

2. Улучшенный процесс обучения:
   - Валидация и ранняя остановка
   - Проверка сходимости
   - Адаптивная скорость обучения
   - Сохранение лучшей модели

3. Реалистичное моделирование:
   - Тепловая инерция помещения
   - Случайные тепловые возмущения
   - Шум Перлина для генерации помех
   - Модуляция и случайные всплески

4. Визуализация результатов:
   - Графики обучения
   - Графики температуры и управляющего сигнала
   - Сохранение результатов с временными метками

5. Поддержка мощных тепловых возмущений:
   - Можно включить несколько мощных тепловых событий за симуляцию (например, имитировать открытие окна или резкое внешнее воздействие)
   - Параметры количества, длительности и амплитуды задаются через командную строку

## Результаты

Система демонстрирует:
- Эффективное достижение различных целевых температур
- Стабильную работу при разных начальных условиях
- Устойчивость к тепловым возмущениям
- Плавное управление без перерегулирования

## Дальнейшие улучшения

1. Реализация онлайн-обучения в процессе работы
2. Адаптивная настройка коэффициента смешивания α
3. Оптимизация архитектуры нейронной сети
4. Добавление прогнозирования температуры
5. Учет энергоэффективности при управлении

## Примечания

- Система адаптирована для работы с различными температурными режимами
- Все параметры могут быть настроены через аргументы командной строки
- Рекомендуется экспериментировать с параметром α для оптимальной работы
- Результаты каждой симуляции сохраняются с уникальной временной меткой